console.log("running module: attachment.js");
var attachment=function(){function d(b){util.checkSuccess("Delete attachment",b)&&(view.refreshTree(null,!1),a.closeUploadPg())}function b(b){util.checkSuccess("Upload from URL",b)&&(view.refreshTree(null,!1),a.closeUploadPg())}var a={uploadNode:null,deleteAttachment:function(){confirmPg.areYouSure("Confirm Delete Attachment","Delete the Attachment on the Node?","Yes, delete.",function(){util.json("deleteAttachment",{nodeId:a.uploadNode.id},d)})},uploadFileNow:function(){var c=$("#uploadFromUrl").val();
c?util.json("uploadFromUrl",{nodeId:a.uploadNode.id,sourceUrl:c},b):($("#uploadFormNodeId").attr("value",a.uploadNode.id),$.ajax({url:postTargetUrl+"upload",type:"POST",data:new FormData($("#uploadForm")[0]),enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,success:function(){view.refreshTree(null,!1);a.closeUploadPg()},error:function(){alert("Upload failed.")}}))},openUploadPgMenuClick:function(){var b=meta64.getHighlightedNode();b?(a.uploadNode=b,meta64.changePage("#uploadPg")):
(a.uploadNode=null,alert("No node is selected."))},closeUploadPg:function(){meta64.changePage("#mainPage");view.scrollToSelectedNode()}};console.log("Module ready: attachment.js");return a}();console.log("running module: cnst.js");var cnst=function(){var d={ANON:"anonymous",COOKIE_LOGIN_USR:cookiePrefix+"loginUsr",COOKIE_LOGIN_PWD:cookiePrefix+"loginPwd",BR:"<div class='vert-space'></div>",INSERT_ATTACHMENT:"{{insert-attachment}}"};console.log("Module ready: cnst.js");return d}();console.log("running module: edit.js");
var edit=function(){var d,b,a=function(a){util.checkSuccess("Save node",a);view.refreshTree(null,!1);meta64.changePage("#mainPage");view.scrollToSelectedNode()},c=function(a){util.checkSuccess("Export",a)&&(alert("Export Successful."),meta64.changePage("#mainPage"),view.scrollToSelectedNode())},f=function(a){util.checkSuccess("Import",a)&&(alert("Import Successful."),view.refreshTree(null,!1),meta64.changePage("#mainPage"),view.scrollToSelectedNode())},e=function(a){console.log("insertBookResponse running.");util.checkSuccess("Insert Book",
a);view.refreshTree(null,!1);meta64.changePage("#mainPage");view.scrollToSelectedNode()},g=function(a){util.checkSuccess("Delete node",a)&&(meta64.clearSelectedNodes(),view.refreshTree(null,!1))},h=function(a){util.checkSuccess("Move nodes",a);l.nodesToMove=null;view.refreshTree(null,!1)},k=function(a){util.checkSuccess("Change node position",a);view.refreshTree(null,!1);meta64.changePage("#mainPage");view.scrollToSelectedNode()},m=function(a){util.checkSuccess("Insert node",a);meta64.newChildNodeId=
a.newNode.id;meta64.initNode(a.newNode);meta64.highlightNode(a.newNode,!0);edit.runEditNode(a.newNode.uid)},p=function(a){util.checkSuccess("Make node referencable",a)&&alert("This node is now referencable, and can be accessed by unique ID")},n=function(a){util.checkSuccess("Create subnode",a);meta64.newChildNodeId=a.newNode.id;console.log("new child identifier: "+meta64.newChildNodeId);meta64.initNode(a.newNode);edit.runEditNode(a.newNode.uid)},l={nodesToMove:null,editingUnsavedNode:!1,editNode:null,
nodeInsertTarget:null,startEditingNewNode:function(){l.editingUnsavedNode=!0;l.editNode=null;meta64.changePage("#editNodePg")},editMode:function(){meta64.editMode=meta64.editMode?!1:!0;var a=$("#editModeButton");a.toggleClass("ui-icon-edit",meta64.editMode);a.toggleClass("ui-icon-forbidden",!meta64.editMode);render.renderPageFromData();view.scrollToSelectedNode()},makeNodeReferencable:function(){util.json("makeNodeReferencable",{nodeId:l.editNode.id},p)},cancelEdit:function(){meta64.treeDirty&&view.refreshTree(null,
!1);meta64.changePage("#mainPage");view.scrollToSelectedNode()},saveNode:function(){l.editingUnsavedNode?l.saveNewNode():l.saveExistingNode()},saveNewNode:function(){var a=util.getRequiredElement("#newNodeNameId").val();meta64.userName!=d.createdBy&&"admin"!=d.createdBy&&(b=!0);meta64.treeDirty=!0;l.nodeInsertTarget?util.json("insertNode",{parentId:d.id,targetName:l.nodeInsertTarget.name,newNodeName:a},m):util.json("createSubNode",{nodeId:d.id,newNodeName:a},n)},saveExistingNode:function(){for(var c=
[],f=0,d=0;;){var e="editNodeTextContent"+f;if(meta64.fieldIdToPropMap.hasOwnProperty(e)){var k=meta64.fieldIdToPropMap[e],e=$("#"+e).val();e!==k.value&&(c.push({name:k.name,value:e}),d++)}else break;f++}0<d?(util.json("saveNode",{nodeId:l.editNode.id,properties:c,sendNotification:b},a),b=!1):alert("You didn't change any information!")},moveNodeUp:function(a){var b=meta64.uidToNodeMap[a];b?(a=meta64.getOrdinalOfNode(b),console.log("ordinal="+a),-1==a&&0>=a||util.json("setNodePosition",{parentNodeId:meta64.currentNodeId,
nodeId:b.name,siblingId:meta64.currentNodeData.children[a-1].name},k)):console.log("idToNodeMap does not contain "+a)},moveNodeDown:function(a){var b=meta64.uidToNodeMap[a];b?(a=meta64.getOrdinalOfNode(b),console.log("ordinal="+a),-1==a&&a>=meta64.currentNodeData.children.length-1||util.json("setNodePosition",{parentNodeId:meta64.currentNodeData.node.id,nodeId:meta64.currentNodeData.children[a+1].name,siblingId:b.name},k)):console.log("idToNodeMap does not contain "+a)},openExportPg:function(){meta64.changePage("#exportPg")},
exportNodes:function(){var a=meta64.getHighlightedNode(),b=util.getRequiredElement("#exportTargetNodeName").val();util.emptyString(b)?alert("Please enter a name for the export file."):a&&util.json("exportToXml",{nodeId:a.id,targetFileName:b},c)},openImportPg:function(){meta64.changePage("#importPg")},importNodes:function(){var a=meta64.getHighlightedNode(),b=util.getRequiredElement("#importTargetNodeName").val();util.emptyString(b)?alert("Please enter a name for the import file."):a&&util.json("import",
{nodeId:a.id,sourceFileName:b},f)},runEditNode:function(a){var b=meta64.uidToNodeMap[a];b?(l.editingUnsavedNode=!1,l.editNode=b,meta64.changePage("#editNodePg")):(l.editNode=null,alert("Unknown nodeId in editNodeClick: "+a))},populateEditNodePg:function(){view.initEditPathDisplayById("#editNodePathDisplay");var a="",b=0;meta64.fieldIdToPropMap={};if(l.editNode)$.each(l.editNode.properties,function(c,f){if(render.allowPropertyToDisplay(f.name)){var e="editNodeTextContent"+b;meta64.fieldIdToPropMap[e]=
f;var d=f.values&&0<f.values.length,k=render.isReadOnlyProperty(f.name),h=render.isBinaryProperty(f.name);if(k||h)e="RdOnly_"+e;var g="";if(!k&&!h){var g=render.makeTag("a",{onClick:"props.clearProperty('"+e+"');","class":"ui-btn ui-btn-inline ui-icon-back ui-btn-icon-left"},"Clear"),m="",l="";"jcr:content"!==f.name&&(l=render.makeTag("a",{onClick:"props.deleteProperty('"+f.name+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Del"),m=render.makeTag("a",{onClick:"props.addSubProperty('"+
e+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Add Multi"));g=m+g+l;g=0<g.length?render.makeHorizontalFieldSet(g):""}d?(console.log("Property multi-type: name="+f.name+" count="+f.values.length),g+=props.makeMultiPropEditor(e,f,k,h)):(console.log("Property single-type: "+f.name),g+=render.makeTag("label",{"for":e},render.sanitizePropertyName(f.name)),d=h?"[binary]":f.value,g=k||h?g+render.makeTag("textarea",{id:e,readonly:"readonly",disabled:"disabled"},d?d:""):g+render.makeTag("textarea",
{id:e},d?d:""));a+=render.makeTag("div",{"class":"ui-field-contain"},g);b++}else console.log("Hiding property: "+f.name)});else var c=render.makeTag("label",{"for":"newNodeNameId"},"New Node Name")+render.makeTag("textarea",{id:"newNodeNameId"},""),a=a+render.makeTag("div",{"class":"ui-field-contain"},c);util.setHtmlEnhanced($("#propertyEditFieldContainer"),a);c=l.editingUnsavedNode?"You may leave this field blank and a unique ID will be assigned. You only need to provide a name if you want this node to have a more meaningful URL.":
"";$("#editNodeInstructions").html(c);util.setVisibility("#addPropertyButton",!l.editingUnsavedNode);util.setVisibility("#makeNodeReferencableButton",!l.editingUnsavedNode)},insertNode:function(a){if(d=meta64.currentNode){if(a=meta64.uidToNodeMap[a])l.nodeInsertTarget=a,l.startEditingNewNode()}else console.log("Unknown nodeId in insertNodeClick: "+a)},createSubNode:function(a){if(a){if(d=meta64.uidToNodeMap[a],!d){console.log("Unknown nodeId in createSubNode: "+a);return}}else d=meta64.currentNode;
l.nodeInsertTarget=null;l.startEditingNewNode()},deleteSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Delete","Delete "+a.length+" node(s) ?","Yes, delete.",function(){util.json("deleteNodes",{nodeIds:a},g)}):alert("You have not selected any nodes. Select nodes to delete first.")},moveSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Move","Move "+a.length+" node(s) to a new location ?",
"Yes, move.",function(){l.nodesToMove=a;meta64.selectedNodes={};alert("Ok, ready to move nodes. To finish moving, go select the target location, then click 'Finish Moving'");meta64.refreshAllGuiEnablement()}):alert("You have not selected any nodes. Select nodes to delete first.")},finishMovingSelNodes:function(){confirmPg.areYouSure("Confirm Move","Move "+l.nodesToMove.length+" node(s) to selected location ?","Yes, move.",function(){var a=meta64.getHighlightedNode();util.json("moveNodes",{targetNodeId:a.id,
targetChildId:null!=a?a.id:null,nodeIds:l.nodesToMove},h)})},insertBookWarAndPeace:function(){confirmPg.areYouSure("Confirm","Insert book War and Peace?","Yes, insert book.",function(){var a=meta64.getHighlightedNode();a?util.json("insertBook",{nodeId:a.id,bookName:"War and Peace"},e):alert("No node is selected.")})}};console.log("Module ready: edit.js");return l}();console.log("running module: meta64.js");
var meta64=function(){var d=!1,b={userName:"anonymous",deviceWidth:0,deviceHeight:0,homeNodeId:"",homeNodePath:"",isAdminUser:!1,isAnonUser:!0,anonUserLandingPageNode:null,treeDirty:!1,uidToNodeMap:{},idToNodeMap:{},nextUid:1,identToUidMap:{},actionNameToObjMap:{},parentUidToFocusNodeMap:{},editMode:!1,MODE_ADVANCED:"advanced",MODE_SIMPLE:"simple",editModeOption:"simple",showProperties:!1,simpleModeNodePrefixBlackList:{"rep:":!0},simpleModePropertyBlackList:{"jcr:primaryType":!0,"rep:policy":!0},
readOnlyPropertyList:{"jcr:uuid":!0,"jcr:mixinTypes":!0,"jcr:created":!0,"jcr:createdBy":!0,"jcr:lastModified":!0,"jcr:lastModifiedBy":!0,imgWidth:!0,imgHeight:!0,binVer:!0,jcrData:!0,"jcr:mimeType":!0},binaryPropertyList:{jcrData:!0},fieldIdToPropMap:{},selectedNodes:{},newChildNodeId:"",currentNodeData:null,currentNode:null,currentNodeUid:null,currentNodeId:null,currentNodePath:null,inSimpleMode:function(){return b.editModeOption===b.MODE_SIMPLE},changePage:function(a){pageMgr.buildPage(a);$.mobile.pageContainer.pagecontainer("change",
a)},popup:function(a){pageMgr.buildPage(a);$(a).popup("open")},isNodeBlackListed:function(a){if(!b.inSimpleMode())return!1;for(var c in b.simpleModeNodePrefixBlackList)if(b.simpleModeNodePrefixBlackList.hasOwnProperty(c)&&a.name.startsWith(c))return!0;return!1},getSelectedNodeUidsArray:function(){var a=[],c=0,f;for(f in b.selectedNodes)b.selectedNodes.hasOwnProperty(f)&&(a[c++]=f);return a},getSelectedNodeIdsArray:function(){var a=[],c=0,f;b.selectedNodes?console.log("selectedNode count: "+b.selectedNodes.length):
console.log("no selected nodes.");for(f in b.selectedNodes)if(b.selectedNodes.hasOwnProperty(f)){var e=b.uidToNodeMap[f];e?a[c++]=e.id:console.log("unable to find uidToNodeMap for uid="+f)}return a},getSelectedNodesArray:function(){var a=[],c=0,f;for(f in b.selectedNodes)b.selectedNodes.hasOwnProperty(f)&&(a[c++]=b.uidToNodeMap[f]);return a},clearSelectedNodes:function(){b.selectedNodes={}},updateNodeInfoResponse:function(a,b){var f="",e=!1;$.each(a.owners,function(a,b){0<f.length&&(f+=",");b===meta64.userName&&
(e=!0);f+=b});if(0<f.length){b.node.owner=f;var d=$("#ownerDisplay"+b.node.uid);d.html(" (Manager: "+f+")");e?util.changeOrAddClass(d,"created-by-other","created-by-me"):util.changeOrAddClass(d,"created-by-me","created-by-other")}},updateNodeInfo:function(a){util.json("getNodePrivileges",{nodeId:a.id,includeAcl:"n",includeOwners:"y"},b.updateNodeInfoResponse,{node:a})},getNodeFromId:function(a){return b.idToNodeMap[a]},getPathOfUid:function(a){var c=b.uidToNodeMap[a];return c?c.path:"[path error. invalid uid: "+
a+"]"},defineAllActions:function(){var a=!util.emptyString(b.currentNode);b.defineActions({name:"openLoginPg",enable:!0,"function":user.openLoginPg},{name:"navHome",enable:a&&!nav.displayingHome(),"function":nav.navHome},{name:"navUpLevel",enable:a&&nav.parentVisibleToUser(),"function":nav.navUpLevel},{name:"propsToggle",enable:a,"function":props.propsToggle},{name:"deleteProperty",enable:!1,"function":props.deleteProperty},{name:"editMode",enable:a,"function":edit.editMode},{name:"makeNodeReferencable",
enable:!0,"function":edit.makeNodeReferencable})},openDonatePg:function(){meta64.changePage("#donatePg")},getHighlightedNode:function(){return b.parentUidToFocusNodeMap[b.currentNodeUid]},highlightRowById:function(a,c){var f=b.getNodeFromId(a);f?b.highlightNode(f,c):console.log("highlightRowById failed to find id: "+a)},highlightNode:function(a,c){if(a){var f=!1,e=b.parentUidToFocusNodeMap[b.currentNodeUid];e&&(e.uid===a.uid?f=!0:(e=e.uid+"_row",e=$("#"+e),util.changeOrAddClass(e,"active-row","inactive-row")));
f||(b.parentUidToFocusNodeMap[b.currentNodeUid]=a,e=a.uid+"_row",e=$("#"+e),util.changeOrAddClass(e,"inactive-row","active-row"));c&&view.scrollToSelectedNode()}},refreshAllGuiEnablement:function(){util.getPropertyCount(b.selectedNodes);var a=b.getHighlightedNode();util.setEnablementByName("navHome",b.currentNode&&!nav.displayingHome());util.setEnablementByName("navUpLevel",b.currentNode&&nav.parentVisibleToUser());util.setEnablementByName("propsToggle",b.currentNode&&!b.isAnonUser);util.setEnablementByName("deleteProperty",
!b.isAnonUser);util.setEnablementByName("editMode",b.currentNode&&!b.isAnonUser);util.setVisibility("#menuButton",!b.isAnonUser);util.setVisibility("#mainMenuSearchButton",!b.isAnonUser&&null!=a);util.setVisibility("#mainMenuTimelineButton",!b.isAnonUser&&null!=a)},defineActions:function(a){for(var c=0;c<arguments.length;c++){var f=arguments[c],e=f.name,d=f["function"];b.actionNameToObjMap[e]=f;if("function"!==typeof d)console.log("Function not found for action "+e);else{var h="#"+e+"Button";if(!util.hookClick(h,
d)){console.log("Failed to hook button: "+e);break}(e=$(h))?util.setEnablement(e,f.enable):console.log("Unable to set enablement. ID not found: "+h)}}},getSingleSelectedNode:function(){for(var a in b.selectedNodes)if(b.selectedNodes.hasOwnProperty(a))return b.uidToNodeMap[a];return null},getOrdinalOfNode:function(a){if(!b.currentNodeData||!b.currentNodeData.children)return-1;for(var c=0;c<b.currentNodeData.children.length;c++)if(a.id===b.currentNodeData.children[c].id)return c;return-1},setCurrentNodeData:function(a){b.currentNodeData=
a;b.currentNode=a.node;b.currentNodeUid=a.node.uid;b.currentNodeId=a.node.id;b.currentNodePath=a.node.path},anonPageLoadResponse:function(a){a.renderNodeResponse?(util.setVisibility("#mainNodeContent",!0),util.setVisibility("#mainNodeStatusBar",!0),render.renderPageFromData(a.renderNodeResponse),b.refreshAllGuiEnablement()):(util.setVisibility("#mainNodeContent",!1),util.setVisibility("#mainNodeStatusBar",!1),console.log("setting listview to: "+a.content),util.setHtmlEnhanced($("#listView"),a.content));
render.renderMainPageControls()},initNode:function(a){a?(a.uid=util.getUidForId(b.identToUidMap,a.id),a.properties=props.setPreferredPropertyOrder(a.properties),b.uidToNodeMap[a.uid]=a,b.idToNodeMap[a.id]=a):console.log("initNode has null node")},initApp:function(){d||(d=!0,b.displaySignupMessage(),console.log("initApp running."),$(window).on("orientationchange",b.orientationHandler),b.defineAllActions(),b.deviceWidth=$(window).width(),b.deviceHeight=$(window).height(),user.refreshLogin(),pageMgr.initializePageBuilders(),
setInterval(function(){var a=$(window).width();a!=b.deviceWidth&&(b.deviceWidth=a,b.deviceHeight=$(window).height(),b.screenSizeChange())},1500))},displaySignupMessage:function(){"ok"===$("#signupCodeResponse").text()&&alert("Signup complete. You may now login.")},screenSizeChange:function(){b.currentNodeData&&$.each(b.currentNodeData.children,function(a,b){b.imgId&&render.adjustImageSize(b)})},orientationHandler:function(a){},loadAnonPageHome:function(a){util.json("anonPageLoad",{ignoreUrl:a},b.anonPageLoadResponse)}};
console.log("Module ready: meta64.js");return b}();console.log("running module: nav.js");
var nav=function(){var d={displayingHome:function(){return meta64.isAnonUser?meta64.currentNodeId===meta64.anonUserLandingPageNode:meta64.currentNodeId===meta64.homeNodeId},parentVisibleToUser:function(){return!d.displayingHome()},showSearchPage:function(){meta64.changePage("#searchResultsPg")},upLevelResponse:function(b,a){b&&b.node?(render.renderPageFromData(b),meta64.highlightRowById(a.id,!0),meta64.refreshAllGuiEnablement()):(alert("No data is visible to you above this node."),util.setEnablementByName("navUpLevel",
!1))},navUpLevel:function(){d.parentVisibleToUser()&&util.json("renderNode",{nodeId:meta64.currentNodeId,upLevel:1},d.upLevelResponse,{id:meta64.currentNodeId})},getSelectedDomElement:function(){var b=meta64.getHighlightedNode();return b&&(b=meta64.uidToNodeMap[b.uid])?util.domElm(b.uid+"_row"):null},clickOnNodeRow:function(b,a){var c=meta64.uidToNodeMap[a];c?(meta64.highlightNode(c,!1),meta64.editMode&&!c.owner&&(console.log("calling updateNodeInfo"),meta64.updateNodeInfo(c)),meta64.refreshAllGuiEnablement()):
console.log("clickOnNodeRow recieved uid that doesn't map to any node. uid="+a)},openNode:function(b){var a=meta64.uidToNodeMap[b];meta64.highlightNode(a,!0);a?view.refreshTree(a.id,!1):alert("Unknown nodeId in openNode: "+b)},toggleNodeSel:function(b){if(util.getRequiredElement()){var a=$("#"+b+"_sel"),c=a.attr("class"),f=c.contains("ui-btn-b");f?(util.changeOrAddClass(a,"ui-btn-b","ui-btn-a"),f=!1):(util.changeOrAddClass(a,"ui-btn-a","ui-btn-b"),f=!0);console.log("Classes: "+c);f?meta64.selectedNodes[b]=
!0:delete meta64.selectedNodes[b];a.enhanceWithin();view.updateStatusBar();meta64.refreshAllGuiEnablement()}else console.log("Unable to find Sel button for uid: "+b)},navHomeResponse:function(b){meta64.clearSelectedNodes();render.renderPageFromData(b);util.scrollToTop();meta64.refreshAllGuiEnablement()},navHome:function(){meta64.isAnonUser?meta64.loadAnonPageHome(!0):util.json("renderNode",{nodeId:meta64.homeNodeId},d.navHomeResponse)}};console.log("Module ready: nav.js");return d}();console.log("running module: pageMgr.js");
var pageMgr=function(){var d=null;console.log("Module ready: pageMgr.js");return{buildPage:function(b){console.log("buildPage: "+b);for(var a=0;a<d.length;a++){var c=d[a];if(b===c.name){console.log("found page builder: "+c.name);c.built||(c.build(),c.built=!0);c.init&&c.init();break}}},initializePageBuilders:function(){d?console.log("initializePageBuilders called twice ?"):d=[{name:"#signupPg",build:signupPg.build,init:signupPg.init},{name:"#loginPg",build:loginPg.build,init:loginPg.init},{name:"#prefsPg",
build:prefsPg.build},{name:"#changePasswordPg",build:changePasswordPg.build,init:changePasswordPg.init},{name:"#exportPg",build:exportPg.build},{name:"#importPg",build:importPg.build},{name:"#searchPg",build:searchPg.build,init:searchPg.init},{name:"#uploadPg",build:uploadPg.build,init:uploadPg.init},{name:"#sharingPg",build:sharingPg.build,init:sharingPg.init},{name:"#shareToPersonPg",build:shareToPersonPg.build,init:shareToPersonPg.init},{name:"#searchResultsPg",build:searchResultsPg.build,init:searchResultsPg.init},
{name:"#editNodePg",build:editNodePg.build,init:editNodePg.init},{name:"#editPropertyPg",build:editPropertyPg.build,init:editPropertyPg.init},{name:"#popupMenuPg",build:popupMenuPg.build,init:popupMenuPg.init},{name:"#confirmPg",build:confirmPg.build,init:confirmPg.init}]}}}();console.log("running module: changePasswordPg.js");
var changePasswordPg=function(){console.log("Module ready: changePasswordPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),b=render.makePasswordField("Password","changePassword1")+render.makePasswordField("Repeat Password","changePassword2"),a=render.makeButton("Change Password","changePasswordActionButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelChangePasswordButton","a"),a=render.makeHorzControlGroup(a+
c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},""+b),d=d+b;util.setHtmlEnhanced($("#changePasswordPg"),d);$("#changePasswordActionButton").on("click",user.changePassword)},init:function(){util.delayedFocus("#changePassword1")}}}();console.log("running module: confirmPg.js");
var confirmPg=function(){var d,b,a,c;console.log("Module ready: confirmPg.js");return{areYouSure:function(f,e,g,h){d=f;b=e;a=g;c=h;meta64.changePage("#confirmPg")},build:function(){var a;a="<h3 id='confirmPgTitle'></h3><p id='confirmPgMessage'></p>"+render.makeBackButton("Yes","confirmPgYesButton","b");a+=render.makeBackButton("No","confirmPgNoButton","a");a=render.makeTag("div",{"data-role":"content"},a);util.setHtmlEnhanced($("#confirmPg"),a)},init:function(){$("#confirmPgTitle").text(d);$("#confirmPgMessage").text(b);
$("#confirmPgYesButton").off("click");$("#confirmPgYesButton").text(a).on("click",function(){c();$(this).off("click")})}}}();console.log("running module: editNodePg.js");
var editNodePg=function(){console.log("Module ready: editNodePg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node</h2>"),b=render.makeButton("Save","saveNodeButton","b","ui-btn-icon-left ui-icon-check"),a=render.makeButton("Add Property","addPropertyButton","a"),c=render.makeButton("Close","cancelEditButton","a"),b=render.makeHorzControlGroup(b+a+c),b=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='editNodePathDisplay' class='path-display-in-editor'></div><div id='editNodeInstructions'></div><div id='propertyEditFieldContainer'></div>"+
b),d=d+b;util.setHtmlEnhanced($("#editNodePg"),d);$("#saveNodeButton").on("click",edit.saveNode);$("#cancelEditButton").on("click",edit.cancelEdit);$("#addPropertyButton").on("click",props.addProperty)},init:function(){edit.populateEditNodePg()}}}();console.log("running module: editPropertyPg.js");
var editPropertyPg=function(){console.log("Module ready: editPropertyPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node Property</h2>"),b=render.makeButton("Save","savePropertyButton","b","ui-btn-icon-left ui-icon-check"),a=render.makeBackButton("Cancel","editPropertyPgCloseButton","a"),b=render.makeHorzControlGroup(b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='editPropertyPathDisplay' class='path-display-in-editor'></div><div id='addPropertyFieldContainer' class='ui-field-contain'></div>"+b),
d=d+b;util.setHtmlEnhanced($("#editPropertyPg"),d);$("#savePropertyButton").on("click",props.saveProperty)},init:function(){props.populatePropertyEdit()}}}();console.log("running module: exportPg.js");
var exportPg=function(){console.log("Module ready: exportPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Export to XML</h2>"),b=render.makeEditField("Export to File Name","exportTargetNodeName"),a=render.makeButton("Export","exportNodesButton","b"),c=render.makeBackButton("Close","cancelExportButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},
""+b),d=d+b;util.setHtmlEnhanced($("#exportPg"),d);$("#exportNodesButton").on("click",edit.exportNodes)}}}();console.log("running module: importPg.js");
var importPg=function(){console.log("Module ready: importPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Import from XML</h2>"),b=render.makeEditField("Import Target Node Name","importTargetNodeName"),a=render.makeButton("Import","importNodesButton","b"),c=render.makeBackButton("Close","cancelImportButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main",
"class":"ui-content"},""+b),d=d+b;util.setHtmlEnhanced($("#importPg"),d);$("#importNodesButton").on("click",edit.importNodes)}}}();console.log("running module: loginPg.js");
var loginPg=function(){console.log("Module ready: loginPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),b=render.makeEditField("User","userName")+render.makePasswordField("Password","password"),a=render.makeButton("Login","loginButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelLoginButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",
{role:"main","class":"ui-content"},""+b),d=d+b;util.setHtmlEnhanced($("#loginPg"),d);$("#loginButton").on("click",user.login);util.bindEnterKey("#userName",user.login);util.bindEnterKey("#password",user.login)},init:function(){util.delayedFocus("#userName")}}}();console.log("running module: popupMenuPg.js");
var popupMenuPg=function(){function d(a,b){return render.makeTag("div",{style:"margin: 0px; padding: 0px;","data-role":"collapsible","data-iconpos":"right","data-shadow":"false","data-corners":"false"},"<h2 style='margin: 0px; padding: 0px;'>"+a+"</h2>"+render.makeTag("ul",{style:"margin: 0px; padding: 0px;","data-role":"listview","data-inset":"true","data-shadow":"false","data-corners":"false"},b))}function b(a,b,d){a=render.makeTag("a",{id:b,onclick:d},a);return render.makeTag("li",{"data-icon":"false"},
a)}var a={build:function(){var a=b("Change Password","changePasswordPgButton","user.changePasswordPg();")+b("Preferences","accountPreferencesPgButton","prefs.accountPreferencesPg();")+b("Insert Book: War and Peace","insertBookWarAndPeaceButton"," edit.insertBookWarAndPeace();")+b("Donate","donatePgButton","meta64.openDonatePg();"),a=d("My Account",a),f=b("Attachments","manageAttachmentsButton","attachment.openUploadPgMenuClick();")+b("Sharing","editNodeSharingButton","share.editNodeSharingMenuClick();")+
b("Move","moveSelNodesButton","edit.moveSelNodes();")+b("Finish Moving","finishMovingSelNodesButton","edit.finishMovingSelNodes();")+b("Export","openExportPgButton","edit.openExportPg();")+b("Import","openImportPgButton","edit.openImportPg();")+b("Delete","deleteSelNodesButton","edit.deleteSelNodes();"),f=d("Edit",f),a=render.makeTag("div",{style:"margin: 0; min-width: 300px; position: fixed; top: 2em; left: 2em;","data-role":"collapsible-set"},a+f);util.setHtmlEnhanced($("#popupMenuPg"),a)},init:function(){var b=
util.getPropertyCount(meta64.selectedNodes),f=meta64.getHighlightedNode(),d=!util.nullOrUndef(edit.nodesToMove)&&!a.isAnonUser;util.setEnablement($("#changePasswordPgButton"),!meta64.isAnonUser);util.setEnablement($("#accountPreferencesPgButton"),!meta64.isAnonUser);util.setEnablement($("#insertBookWarAndPeaceButton"),meta64.isAdminUser&&null!=f,meta64.isAdminUser);util.setEnablement($("#donatePgButton"),!0);util.setEnablement($("#manageAttachmentsButton"),null!=f);util.setEnablement($("#editNodeSharingButton"),
null!=f);util.setEnablement($("#moveSelNodesButton"),null!=f);util.setEnablement($("#finishMovingSelNodesButton"),d);util.setEnablement($("#openExportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#openImportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#deleteSelNodesButton"),b)}};console.log("Module ready: popupMenuPg.js");return a}();console.log("running module: prefsPg.js");
var prefsPg=function(){console.log("Module ready: prefsPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Account Peferences</h2>"),b=render.makeRadioButton("Simple","editModeRadioGroup","editModeSimple",!0)+render.makeRadioButton("Advanced","editModeRadioGroup","editModeAdvanced",!1),b=render.makeHorzControlGroup("<legend>Edit Mode:</legend>"+b),a=render.makeButton("Save","savePreferencesButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Cancel",
"cancelPreferencesPgButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},""+b),d=d+b;util.setHtmlEnhanced($("#prefsPg"),d);$("#savePreferencesButton").on("click",prefs.savePreferences)}}}();console.log("running module: searchPg.js");
var searchPg=function(){console.log("Module ready: searchPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Search</h2>"),b=render.makeEditField("Search","searchText"),a=render.makeButton("Search","searchNodesButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelSearchButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},
""+b),d=d+b;util.setHtmlEnhanced($("#searchPg"),d);$("#searchNodesButton").on("click",srch.searchNodes);util.bindEnterKey("#searchText",srch.searchNodes)},init:function(){util.delayedFocus("#searchText")}}}();console.log("running module: searchResultsPg.js");
var searchResultsPg=function(){console.log("Module ready: searchResultsPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},render.makeButton("Back to Content","cancelSearchResultsButton","b")+"<h2>"+BRANDING_TITLE+" - Search Results</h2>"),b=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='searchResultsView'></div>"),d=d+b;util.setHtmlEnhanced($("#searchResultsPg"),d);$("#cancelSearchResultsButton").on("click",function(){meta64.changePage("#mainPage");
view.scrollToSelectedNode()})},init:function(){srch.populateSearchResultsPage()}}}();console.log("running module: shareToPersonPg.js");
var shareToPersonPg=function(){console.log("Module ready: shareToPersonPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Share Node to Person</h2>"),b=render.makeEditField("User to Share With","shareToUserName"),a=render.makeButton("Share","shareNodeToPersonButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelShareNodeToPersonButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},
b+a),b=render.makeTag("div",{role:"main","class":"ui-content"},"Enter the username of the person you want to share this node with:"+b),d=d+b;util.setHtmlEnhanced($("#shareToPersonPg"),d);$("#shareNodeToPersonButton").on("click",share.shareNodeToPerson)}}}();console.log("running module: sharingPg.js");
var sharingPg=function(){console.log("Module ready: sharingPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Node Sharing</h2>"),b=render.makeButton("Share with Person","shareNodeToPersonPgButton","a"),a=render.makeButton("Share to Public","shareNodeToPublicButton","a"),c=render.makeBackButton("Close","cancelSharingButton","a"),b=render.makeHorzControlGroup(b+a+c),b=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='shareNodeNameDisplay'></div><div id='sharingListFieldContainer'></div>"+
b),d=d+b;util.setHtmlEnhanced($("#sharingPg"),d);$("#shareNodeToPersonPgButton").on("click",share.shareNodeToPersonPg);$("#shareNodeToPublicButton").on("click",share.shareNodeToPublic)},init:function(){share.reload()}}}();console.log("running module: signupPg.js");
var signupPg=function(){console.log("Module ready: signupPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Signup</h2>"),b=render.makeEditField("User","signupUserName")+render.makePasswordField("Password","signupPassword")+render.makeEditField("Email","signupEmail")+render.makeEditField("Captcha","signupCaptcha"),a=render.makeTag("div",{"class":"captcha-image"},render.makeTag("img",{id:"captchaImage","class":"captcha",src:""},"",!1)),c=render.makeButton("Signup",
"signupButton","b","ui-btn-icon-left ui-icon-check"),f=render.makeButton("Try Different Image","tryAnotherCaptchaButton","a"),e=render.makeBackButton("Close","cancelSignupButton","a"),c=render.makeHorzControlGroup(c+f+e),b=render.makeTag("div",{"class":"ui-field-contain"},b+a+c),b=render.makeTag("div",{role:"main","class":"ui-content"},"Note: No email address is required currently, because this app is an alpha site that doesn't yet have email support."+b),d=d+b;util.setHtmlEnhanced($("#signupPg"),
d);$("#tryAnotherCaptchaButton").on("click",user.tryAnotherCaptcha);$("#signupButton").on("click",user.signup)},init:function(){user.pageInitSignupPg();util.delayedFocus("#signupUserName")}}}();console.log("running module: uploadPg.js");
var uploadPg=function(){console.log("Module ready: uploadPg.js");return{build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Upload File Attachment</h2>"),b=render.makeTag("div",{id:"uploadPathDisplay","class":"path-display-in-editor"},""),a=render.makeTag("input",{type:"file",name:"file"},"",!0)+render.makeTag("input",{id:"uploadFormNodeId",type:"hidden",name:"nodeId"}),a=render.makeTag("form",{id:"uploadForm",method:"POST",enctype:"multipart/form-data"},a),
a=render.makeTag("div",{id:"uploadFieldContainer"},"<p>Upload from your computer</p>"+a),c=render.makeEditField("Upload From URL","uploadFromUrl"),c=render.makeTag("div",{},c),f=render.makeButton("Upload","uploadButton","b","ui-btn-icon-left ui-icon-check"),e=render.makeButton("Delete","deleteAttachmentButton","a"),g=render.makeBackButton("Close","closeUploadButton","a"),f=render.makeHorzControlGroup(f+e+g),b=render.makeTag("div",{role:"main","class":"ui-content"},b+a+"<div><h3>-- OR --</h3></div>"+
c+f);util.setHtmlEnhanced($("#uploadPg"),d+b);$("#uploadButton").on("click",attachment.uploadFileNow);$("#deleteAttachmentButton").on("click",attachment.deleteAttachment)},init:function(){$("#uploadFromUrl").val("");$("#uploadPathDisplay").html("Path: "+render.formatPath(attachment.uploadNode.path))}}}();console.log("running module: prefs.js");
var prefs=function(){var d={savePreferencesResponse:function(b){util.checkSuccess("Saving Preferences",b)&&(meta64.changePage("#mainPage"),view.scrollToSelectedNode())},savePreferences:function(){meta64.editModeOption=$("#editModeSimple").is(":checked")?meta64.MODE_SIMPLE:meta64.MODE_ADVANCED;util.json("saveUserPreferences",{userPreferences:{advancedMode:meta64.editModeOption===meta64.MODE_ADVANCED}},d.savePreferencesResponse)},populatePreferencesPg:function(){$("#editModeSimple").prop("checked",meta64.editModeOption===
meta64.MODE_SIMPLE).checkboxradio("refresh");$("#editModeAdvanced").prop("checked",meta64.editModeOption===meta64.MODE_ADVANCED).checkboxradio("refresh")},accountPreferencesPg:function(){meta64.changePage("#prefsPg");d.populatePreferencesPg()}};console.log("Module ready: prefs.js");return d}();console.log("running module: props.js");
var props=function(){var d=function(a){util.checkSuccess("Save properties",a);edit.editNode.properties.push(a.propertySaved);meta64.changePage("#editNodePg");meta64.treeDirty=!0},b=function(a,b){util.checkSuccess("Delete property",a)&&(props.deletePropertyFromLocalData(b.propertyToDelete),meta64.changePage("#editNodePg"),meta64.treeDirty=!0)},a={propsToggle:function(){meta64.showProperties=meta64.showProperties?!1:!0;var a=$("#propsToggleButton");a.toggleClass("ui-icon-grid",meta64.showProperties);
a.toggleClass("ui-icon-forbidden",!meta64.showProperties);render.renderPageFromData();view.scrollToSelectedNode()},deleteProperty:function(b){confirmPg.areYouSure("Confirm Delete","Delete the Property","Yes, delete.",function(){a.deletePropertyImmediate(b)})},deletePropertyImmediate:function(a){util.json("deleteProperty",{nodeId:edit.editNode.id,propName:a},b,{propertyToDelete:a})},addProperty:function(){meta64.changePage("#editPropertyPg")},populatePropertyEdit:function(){var a;a=""+render.makeTag("label",
{"for":"addPropertyNameTextContent"},"Name");a+=render.makeTag("textarea",{name:"addPropertyNameTextContent",id:"addPropertyNameTextContent",placeholder:"Enter property name"},"");a+=render.makeTag("label",{"for":"addPropertyValueTextContent"},"Value");a+=render.makeTag("textarea",{name:"addPropertyValueTextContent",id:"addPropertyValueTextContent",placeholder:"Enter property text"},"");view.initEditPathDisplayById("#editPropertyPathDisplay");util.setHtmlEnhanced($("#addPropertyFieldContainer"),a)},
saveProperty:function(){var a=$("#addPropertyNameTextContent").val(),b=$("#addPropertyValueTextContent").val();util.json("saveProperty",{nodeId:edit.editNode.id,propertyName:a,propertyValue:b},d)},addSubProperty:function(a){a=meta64.fieldIdToPropMap[a];util.isObject(a.values)||(a.values=[],a.values.push(a.value),a.value=null);a.values.push("");edit.populateEditNodePg()},clearProperty:function(a){var b=$("#"+a);0!=b.length&&b.val("");for(var d=0;1E3>d;){b=$("#"+a+"_subProp"+d);if(0==b.length)break;
b.val("");d++}},deletePropertyFromLocalData:function(a){for(var b=0;b<edit.editNode.properties.length;b++)if(a===edit.editNode.properties[b].name){edit.editNode.properties.splice(b,1);break}},makeMultiPropEditor:function(a,b,d,g){var h="",k=b.values;k&&0!=k.length||(k=[],k.push(""));for(var m=0;m<k.length;m++){console.log("prop multi-val["+m+"]="+k[m]);var p=a+"_subProp"+m,h=h+render.makeTag("label",{"for":p},(0==m?b.name:"*")+"."+m),n=g?"[binary]":k[m],h=g||d?h+render.makeTag("textarea",{id:p,readonly:"readonly",
disabled:"disabled"},n?n:""):h+render.makeTag("textarea",{id:p},n?n:"")}return h},setPreferredPropertyOrder:function(a){if(a){var b=[];$.each(a,function(a,c){"jcr:content"===c.name?b.unshift(c):b.push(c)});return b}},renderProperties:function(a){if(a){var b="<table data-role='table' class='prop-table ui-responsive ui-shadow table-stripe property-text'>",d=0,b=b+"<thead><tr><th></th><th></th></tr></thead>",b=b+"<tbody>";$.each(a,function(a,c){if(render.allowPropertyToDisplay(c.name)){var k=render.isBinaryProperty(c.name);
d++;b+="<tr class='prop-table-row'>";b+="<td class='prop-table-name-col'>"+render.sanitizePropertyName(c.name)+"</td>";b=k?b+"<td class='prop-table-val-col'>[binary]</td>":c.values?b+("<td class='prop-table-val-col'>"+props.renderPropertyValues(c.values)+"</td>"):b+("<td class='prop-table-val-col'>"+render.markdown(c.value)+"</td>");b+="</tr>"}else console.log("Hiding property: "+c.name)});return 0==d?"":b+="</tbody></table>"}},getNodeProperty:function(a,b){if(!b||!b.properties)return null;for(var d=
0;d<b.properties.length;d++){var g=b.properties[d];if(g.name===a)return g}return null},renderProperty:function(b){return b.values?a.renderPropertyValues(b.values):b.value&&0!=b.value.length?render.markdown(b.value):""},renderPropertyValues:function(a){var b="<div>";$.each(a,function(a,c){b+=render.markdown(c)+cnst.BR});return b+="</div>"}};console.log("Module ready: props.js");return a}();console.log("running module: render.js");
var render=function(){var d,b={renderNodeContent:function(a,c,f,d,g){var h="";f&&meta64.editMode&&(h+="<div class='path-display'>Path: "+b.formatPath(a.path)+"</div>",h+="<div>",a.createdBy&&(h+="<span class='"+(a.createdBy===meta64.userName?"created-by-me":"created-by-other")+"'>Created By: "+a.createdBy+"</span>"),h+="<span id='ownerDisplay"+a.uid+"'></span>",h+="</div>");!c||!meta64.editMode||a.id===a.path&&f||(h+="ID: "+a.id+cnst.BR);d&&!f&&a.name&&(h+="Name: "+a.name+" [uid="+a.uid+"]");c="";
h&&(c+=b.makeTag("div",{"class":"header-text"},h));if(meta64.showProperties)(h=props.renderProperties(a.properties))&&(c+=h);else if(h=props.getNodeProperty("jcr:content",a))h=props.renderProperty(h),0<h.length&&(c+=b.makeTag("div",{"class":"jcr-content"},b.markdown(h)));g&&a.hasBinary&&(a.binaryIsImage?a=b.makeImageTag(a):(a=b.makeTag("a",{href:b.getUrlForNodeAttachment(a)},"[Download Attachment]"),a=b.makeTag("div",{"class":"binary-link"},a)),c=c.contains(cnst.INSERT_ATTACHMENT)?c.replaceAll(cnst.INSERT_ATTACHMENT,
a):c+a);return c},renderNodeAsListItem:function(a,c,f,d){var g=a.uid,h=a.id===meta64.newChildNodeId;d=0<c&&1<d;c=c<f-1;f=a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");f=meta64.isAdminUser||!f;var k=meta64.getHighlightedNode();!h&&k&&k.uid===g&&(h=!0);d=b.makeRowButtonBarHtml(g,d,c,f);return b.makeTag("div",{"class":"node-table-row"+(h?" active-row":" inactive-row"),onClick:"nav.clickOnNodeRow(this, '"+g+"');",id:g+"_row"},d+b.makeTag("div",{id:g+"_content"},b.renderNodeContent(a,
!0,!0,!0,!0)))},makeRowButtonBarHtml:function(a,c,d,e){var g=selButton=createSubNodeButton=editNodeButton=moveNodeUpButton=moveNodeDownButton=insertNodeButton="";b.nodeHasChildren(a)&&(g=b.makeTag("a",{onClick:"nav.openNode('"+a+"');","class":"ui-btn ui-btn-b ui-btn-inline ui-icon-plus ui-mini ui-btn-icon-left"},"Open"));meta64.editMode&&(selButton=b.makeTag("a",{id:a+"_sel",onClick:"nav.toggleNodeSel('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-check ui-mini ui-btn-icon-left "+(meta64.selectedNodes[a]?
"ui-btn-b":"ui-btn-a")},"Sel"),createSubNodeButton=b.makeTag("a",{onClick:"edit.createSubNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-mini ui-btn-icon-left"},"New"),insertNodeButton=b.makeTag("a",{onClick:"edit.insertNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-bars ui-mini ui-btn-icon-left"},"Ins"));meta64.editMode&&e&&(editNodeButton=b.makeTag("a",{onClick:"edit.runEditNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-edit ui-mini ui-btn-icon-left"},"Edit"),meta64.currentNode.childrenOrdered&&
(c&&(moveNodeUpButton=b.makeTag("a",{onClick:"edit.moveNodeUp('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-u ui-mini ui-btn-icon-left"},"Up")),d&&(moveNodeDownButton=b.makeTag("a",{onClick:"edit.moveNodeDown('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-d ui-mini ui-btn-icon-left"},"Dn"))));a=selButton+g+insertNodeButton+createSubNodeButton+editNodeButton+moveNodeUpButton+moveNodeDownButton;return 0<a.length?b.makeHorizontalFieldSet(a,"compact-field-contain"):""},makeHorizontalFieldSet:function(a,
c){var d=b.makeTag("fieldset",{"data-role":"controlgroup","data-type":"horizontal"},a);return b.makeTag("div",{"class":"ui-field-contain"+(c?" "+c:"")},d)},makeHorzControlGroup:function(a){return b.makeTag("div",{"data-role":"controlgroup","data-type":"horizontal"},a)},makeRadioButton:function(a,c,d,e){return b.makeTag("input",{type:"radio",name:c,id:d,checked:e?"checked":"unchecked"},"",!0)+b.makeTag("label",{"for":d},a)},nodeHasChildren:function(a){var b=meta64.uidToNodeMap[a];if(b)return b.hasChildren;
console.log("Unknown nodeId in nodeHasChildren: "+a);return!1},formatPath:function(a){return meta64.isAdminUser?a:a.replaceAll("/root","")},markdown:function(a){d||(d=(new Markdown.getSanitizingConverter).makeHtml);return"<div data-ajax='false'>"+d(a)+"</div>"},renderMainPageControls:function(){var a="";0<srch.numSearchResults()&&(a+=render.makeTag("a",{onClick:"nav.showSearchPage();","class":"ui-btn ui-btn-inline ui-icon-search ui-btn-icon-left"},"Back to Search Results"));var b=0<a.length;b&&util.setHtmlEnhanced($("#mainPageControls"),
a);util.setVisibility("#mainPageControls",b)},renderPageFromData:function(a){var c=!1;a?c=!0:a=meta64.currentNodeData;if(a&&a.node){util.setVisibility("#listView",!0);b.renderMainPageControls();meta64.treeDirty=!1;c&&(meta64.uidToNodeMap={},meta64.idToNodeMap={},meta64.selectedNodes={},meta64.initNode(a.node),meta64.setCurrentNodeData(a));var d="",e=b.renderNodeContent(a.node,!0,!0,!0,!0);if(0<e.length){var g=a.node.uid,e=b.makeTag("div",{"class":"node-table-row inactive-row",onClick:"nav.clickOnNodeRow(this, '"+
g+"');",id:g+"_row"},e);$("#mainNodeContent").show();$("#mainNodeContent").html(e)}else $("#mainNodeContent").hide();view.updateStatusBar();b.renderMainPageControls();if(a.children){var h=a.children.length,k=0;$.each(a.children,function(a,e){var g=b.generateRow(a,e,c,h,k);0!=g.length&&(d+=g,k++)})}0!=d.length||meta64.isAnonUser||(d=b.makeTag("a",{onClick:"edit.createSubNode();","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Create Content"));util.setHtmlEnhancedById("#listView",d);
meta64.getHighlightedNode()||util.scrollToTop()}else util.setVisibility("#listView",!1),$("#mainNodeContent").html("No default content is available.")},generateRow:function(a,c,d,e,g){if(meta64.isNodeBlackListed(c))return"";d&&meta64.initNode(c);g++;return b.renderNodeAsListItem(c,a,e,g)},getUrlForNodeAttachment:function(a){return postTargetUrl+"bin?nodeId="+encodeURIComponent(a.path)+"&ver="+a.binVer},adjustImageSize:function(a){var b=$("#"+a.imgId);if(b){var d=b.attr("width"),e=b.attr("height");
a.width&&a.height&&(a.width>meta64.deviceWidth-50?(d=meta64.deviceWidth-50,e=d*a.height/a.width,b.attr("width",d),b.attr("height",e)):(b.attr("width",a.width),b.attr("height",a.height)))}},makeImageTag:function(a){var c=b.getUrlForNodeAttachment(a);a.imgId="imgUid_"+a.uid;if(a.width&&a.height){if(a.width>meta64.deviceWidth-50){var d=meta64.deviceWidth-50;return b.makeTag("img",{src:c,id:a.imgId,width:d+"px",height:d*a.height/a.width+"px"},null,!1)}return b.makeTag("img",{src:c,id:a.imgId,width:a.width+
"px",height:a.height+"px"},null,!1)}return b.makeTag("img",{src:c,id:a.imgId},null,!1)},makeTag:function(a,b,d,e){"undefined"===typeof e&&(e=!0);var g="<"+a;b&&(g+=" ",$.each(b,function(a,b){g=b.contains("'")?g+(a+'="'+b+'" '):g+(a+"='"+b+"' ")}));return g=e?g+(">"+d+"</"+a+">"):g+"/>"},makeEditField:function(a,c){return b.makeTag("label",{"for":c},a)+b.makeTag("input",{type:"text",name:c,id:c},"",!0)},makePasswordField:function(a,c){return b.makeTag("label",{"for":c},a)+b.makeTag("input",{type:"password",
name:c,id:c},"",!0)},makeButton:function(a,b,d,e){d="ui-btn ui-btn-inline ui-btn-"+d;e&&(d+=" "+e);return render.makeTag("a",{id:b,"class":d},a)},makeBackButton:function(a,b,d){return render.makeTag("a",{id:b,"class":"ui-btn ui-icon-carat-l ui-btn-inline ui-btn-"+d,"data-rel":"back"},a)},allowPropertyToDisplay:function(a){return null==meta64.simpleModePropertyBlackList[a]},isReadOnlyProperty:function(a){return meta64.readOnlyPropertyList[a]},isBinaryProperty:function(a){return meta64.binaryPropertyList[a]},
sanitizePropertyName:function(a){return"simple"===meta64.editModeOption?"jcr:content"===a?"Content":a:a}};console.log("Module ready: render.js");return b}();console.log("running module: search.js");
var srch=function(){var d=function(a){b.searchResults=a;meta64.changePage("#searchResultsPg")},b={searchResults:null,highlightRowNode:null,identToUidMap:{},uidToNodeMap:{},numSearchResults:function(){return null!=srch.searchResults&&null!=srch.searchResults.searchResults&&null!=srch.searchResults.searchResults.length?srch.searchResults.searchResults.length:0},searchNodes:function(){var a=meta64.getHighlightedNode();if(a){var b=$.trim($("#searchText").val());util.emptyString(b)?alert("Enter search text."):
util.json("nodeSearch",{nodeId:a.id,searchText:b,modSortDesc:!1},d)}else alert("No node is selected to search under.")},timeline:function(){var a=meta64.getHighlightedNode();a?util.json("nodeSearch",{nodeId:a.id,searchText:"",modSortDesc:!0},d):alert("No node is selected to search under.")},searchPg:function(){meta64.changePage("#searchPg")},initSearchNode:function(a){a.uid=util.getUidForId(b.identToUidMap,a.id);b.uidToNodeMap[a.uid]=a},populateSearchResultsPage:function(a){a||(a=b.searchResults);
var c="",d=a.searchResults.length,e=0;$.each(a.searchResults,function(a,h){meta64.isNodeBlackListed(h)||(b.initSearchNode(h),e++,c+=b.renderSearchResultAsListItem(h,a,d,e))});util.setHtmlEnhanced($("#searchResultsView"),c)},renderSearchResultAsListItem:function(a,c,d,e){c=a.uid;a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");return render.makeTag("div",{"class":"node-table-row inactive-row",onClick:"srch.clickOnSearchResultRow(this, '"+c+"');",id:c+"_srch_row"},b.makeButtonBarHtml(c)+
render.makeTag("div",{id:c+"_srch_content"},render.renderNodeContent(a,!0,!0,!0,!0)))},makeButtonBarHtml:function(a){a=render.makeTag("a",{onClick:"srch.clickSearchNode('"+a+"');","class":"ui-btn ui-mini ui-btn-b ui-btn-inline ui-icon-carat-l ui-btn-icon-left"},"Go to Node");return render.makeHorizontalFieldSet(a)},clickOnSearchResultRow:function(a,c){b.unhighlightRow();b.highlightRowNode=b.uidToNodeMap[c];util.changeOrAddClass(a,"inactive-row","active-row")},clickSearchNode:function(a){srch.highlightRowNode=
srch.uidToNodeMap[a];view.refreshTree(srch.highlightRowNode.id,!0);meta64.changePage("#mainPage")},unhighlightRow:function(){if(b.highlightRowNode){var a=util.domElm(b.highlightRowNode.uid+"_srch_row");a&&util.changeOrAddClass(a,"active-row","inactive-row")}}};console.log("Module ready: search.js");return b}();console.log("running module: user.js");
var share=function(){var d=function(a){c.populateSharingPg(a)},b=function(a,b){var c="";$.each(b.privileges,function(b,d){var e=render.makeTag("a",{onClick:"share.removePrivilege('"+a+"', '"+d.privilegeName+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Remove"),e=render.makeHorizontalFieldSet(e),e=e+("<b>"+a+"</b> has privilege <b>"+d.privilegeName+"</b> on this node.");c+=render.makeTag("div",{"class":"privilege-entry"},e)});return c},a=function(a){util.json("getNodePrivileges",
{nodeId:c.sharingNode.path,includeAcl:"y",includeOwners:"y"},d)},c={sharingNode:null,populateSharingPg:function(a){var c="<h2>Access Control Entries</h2>";$.each(a.aclEntries,function(a,d){c+="<h4>User: "+d.principalName+"</h4>";c+=render.makeTag("div",{"class":"privilege-list"},b(d.principalName,d))});""===c&&(c="Node is not shared with anyone.");util.setHtmlEnhanced($("#sharingListFieldContainer"),c)},removePrivilege:function(b,d){util.json("removePrivilege",{nodeId:c.sharingNode.id,principal:b,
privilege:d},a)},shareNodeToPersonPg:function(){meta64.changePage("#shareToPersonPg")},shareNodeToPerson:function(){var a=$("#shareToUserName").val();a?util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:a,privileges:["read","write","addChildren","nodeTypeManagement"]},c.reloadFromShareWithPerson):alert("Please enter a username")},shareNodeToPublic:function(){console.log("Sharing node to public.");util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:"everyone",privileges:["read"]},
c.reload)},editNodeSharingMenuClick:function(){var a=meta64.getHighlightedNode();a?(c.sharingNode=a,meta64.changePage("#sharingPg")):alert("No node is selected.")},reloadFromShareWithPerson:function(a){util.checkSuccess("Share Node with Person",a)&&meta64.changePage("#sharingPg")},reload:function(){console.log("Loading node sharing info.");util.json("getNodePrivileges",{nodeId:c.sharingNode.id,includeAcl:"y",includeOwners:"y"},d)}};console.log("Module ready: share.js");return c}();console.log("running module: user.js");
var user=function(){var d=function(a){var b=BRANDING_TITLE;meta64.isAnonUser||(b+=" - "+a.userName);$("#headerUserName").html(b);a=meta64.isAnonUser;$("#openLoginPgButton").text(a?"Login":"Logout")},b=function(a){a.rootNode&&(meta64.homeNodeId=a.rootNode.id,meta64.homeNodePath=a.rootNode.path);meta64.userName=a.userName;meta64.isAdminUser="admin"===a.userName;meta64.isAnonUser="anonymous"===a.userName;meta64.anonUserLandingPageNode=a.anonUserLandingPageNode;meta64.editModeOption=a.userPreferences.advancedMode?
meta64.MODE_ADVANCED:meta64.MODE_SIMPLE},a=function(a,c){util.checkSuccess("Login",a)?("anonymous"!=c.usr&&(h.writeCookie(cnst.COOKIE_LOGIN_USR,c.usr),h.writeCookie(cnst.COOKIE_LOGIN_PWD,c.pwd)),meta64.changePage("#mainPage"),b(a),view.refreshTree(util.emptyString(a.homeNodeOverride)?meta64.homeNodeId:a.homeNodeOverride,!1),d(a)):c.usingCookies&&(alert("Cookie login failed."),$.removeCookie(cnst.COOKIE_LOGIN_USR),$.removeCookie(cnst.COOKIE_LOGIN_PWD),location.reload())},c=function(a){b(a);d(a);meta64.loadAnonPageHome(!1)},
f=function(a){meta64.changePage("#mainPage");location.reload()},e=function(a){util.checkSuccess("Change password",a)&&alert("Password changed successfully.")},g=function(a){util.checkSuccess("Signup new user",a)&&(user.populateLoginPgFromCookies(),meta64.changePage("#loginPg"),alert("User Information Accepted. \n\nCheck your email for signup confirmation. (Can take up to 1 minute)"))},h={writeCookie:function(a,b){$.cookie(a,b,{expires:365,path:"/"})},populateLoginPgFromCookies:function(){var a=$.cookie(cnst.COOKIE_LOGIN_USR),
b=$.cookie(cnst.COOKIE_LOGIN_PWD);a&&$("#userName").val(a);b&&$("#password").val(b)},openLoginPg:function(){meta64.isAnonUser?(h.populateLoginPgFromCookies(),util.setVisibility("#loginCredentialFields",meta64.isAnonUser),meta64.changePage("#loginPg")):h.logout()},signup:function(){var a=util.getRequiredElement("#signupUserName").val(),b=util.getRequiredElement("#signupPassword").val(),c=util.getRequiredElement("#signupEmail").val(),d=util.getRequiredElement("#signupCaptcha").val();util.anyEmpty(a,
b,c,d)?alert("Sorry, you cannot leave any fields blank."):util.json("signup",{userName:a,password:b,email:c,captcha:d},g)},pageInitSignupPg:function(){user.tryAnotherCaptcha()},tryAnotherCaptcha:function(){var a="/mobile/rest/captcha?t="+util.currentTimeMillis();$("#captchaImage").attr("src",a)},refreshLogin:function(){var b=$.cookie(cnst.COOKIE_LOGIN_USR),d=$.cookie(cnst.COOKIE_LOGIN_PWD),f=!util.emptyString(b)&&!util.emptyString(d),b=b?b:"{session}",d=d?d:"{session}";util.json("login",{userName:b,
password:d,usingCookies:f,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime},f?a:c,{usr:b,pwd:d,usingCookies:f})},login:function(){var b=$.trim($("#userName").val()),c=$.trim($("#password").val());util.json("login",{userName:b,password:c,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime},a,{usr:b,pwd:c})},logout:function(){$.removeCookie(cnst.COOKIE_LOGIN_USR);$.removeCookie(cnst.COOKIE_LOGIN_PWD);util.json("logout",{},f)},changePassword:function(){var a=util.getRequiredElement("#changePassword1").val(),
b=util.getRequiredElement("#changePassword2").val();a&&4<=a.length&&a===b?util.json("changePassword",{newPassword:a},e):alert("Sorry, invalid password(s).")},changePasswordPg:function(){meta64.changePage("#changePasswordPg")}};console.log("Module ready: user.js");return h}();console.log("running module: util.js");
var util=function(){Date.prototype.stdTimezoneOffset=function(){var b=new Date(this.getFullYear(),0,1),a=new Date(this.getFullYear(),6,1);return Math.max(b.getTimezoneOffset(),a.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(b){return 0===this.indexOf(b)});"function"!=typeof String.prototype.contains&&(String.prototype.contains=function(b){return-1!=
this.indexOf(b)});"function"!=typeof String.prototype.replaceAll&&(String.prototype.replaceAll=function(b,a){return this.replace(new RegExp(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),a)});var d={daylightSavingsTime:(new Date).dst()?!0:!1,json:function(b,a,c,d){"function"!==typeof c&&console.log("callback not valid function for postName "+b);$.ajax({url:postTargetUrl+b,contentType:"application/json",type:"post",dataType:"json",cache:!1,data:JSON.stringify(a),success:function(a,g){"success"===
g?c(a,d):console.log("JSON: "+b+" -> "+g)},error:function(a,b,c){alert("Server request failed.")}})},delayedFocus:function(b){setTimeout(function(){$(b).focus()},500)},checkSuccess:function(b,a){a.success||alert(b+" failed: "+a.message);return a.success},nullOrUndef:function(b){return null===b||void 0===b},getUidForId:function(b,a){var c=b[a];c||(c=meta64.nextUid++,b[a]=c);return c},getPreviousPage:function(){var b="#"+$.mobile.activePage.prev('div[data-role="page"]')[0].id;alert("prevPage="+b);return b},
domElm:function(b){if(b.contains("#"))return console.log("do not use # in domElm"),null;var a=document.getElementById(b);a&&0!=a.length||console.log("domElm Error. Required element id not found: "+b);return a},getRequiredElement:function(b){var a=$(b);null==a&&console.log("getRequiredElement. Required element id not found: "+b);return a},isObject:function(b){return b&&0!=b.length},currentTimeMillis:function(){return(new Date).getMilliseconds()},emptyString:function(b){return!b||0==b.length},isActionEnabled:function(b){var a=
meta64.actionNameToObjMap[b];if(a)return a.enable;alert("Unrecognized actionName: "+b)},setEnablementByName:function(b,a,c){var f=meta64.actionNameToObjMap[b];if(f){if(f.enable=a,b=$("#"+b+"Button"))d.setEnablement(b,a),"undefined"===typeof c||c?d.setVisibility(b,!0):d.setVisibility(b,!1)}else alert("Unrecognized actionName: "+b)},setEnablement:function(b,a,c){"undefined"===typeof c||c?d.setVisibility(b,!0):d.setVisibility(b,!1);a&&b.removeClass("ui-state-disabled");a||b.addClass("ui-state-disabled")},
hookSliderChanges:function(){for(var b=0;b<arguments.length;b++){var a=arguments[b]+"SliderChange",c=window[a];"function"!==typeof c&&alert("Function not found: "+a);if(!hookSlider("#"+arguments[b]+"Slider",c)){alert("Failed to hook slider: "+arguments[b]);break}}},hookSlider:function(b,a){d.getRequiredElement(b).change(a);return!0},hookClick:function(b,a){$(b).on("click",a);return!0},bindEnterKey:function(b,a){d.bindKey(b,a,13)},bindKey:function(b,a,c){$(b).keypress(function(b){if(b.which==c)return a(),
!1})},anyEmpty:function(){for(var b=0;b<arguments.length;b++){var a=arguments[b];if(!a||0==a.length)return!0}return!1},changeOrAddClass:function(b,a,c){b=$(b);b.toggleClass(a,!1);b.toggleClass(c,!0)},changeOrAddClass__mine:function(b,a,c){if(b.className&&0!=b.className.length){for(var d=b.className.split(" "),e="",g=!1,h=0;h<d.length;h++){var k=d[h];if(k===c){if(g)continue;g=!0}else if(k===a){if(g)continue;k=c;g=!0}0<e.length&&(e+=" ");e+=k}g||(0<e.length&&(e+=" "),e+=c);b.className=e}else console.log("no existing className is available on element, so assigning to "+
c),b.className=c},verifyType:function(b,a,c){return typeof b!==a?(alert(c),!1):!0},setHtmlEnhancedById:function(b,a){var c=d.getRequiredElement(b);c?($(c).html(a),$(c).enhanceWithin()):console.log("setting failed.")},setHtmlEnhanced:function(b,a){b.html(a);b.enhanceWithin()},getPropertyCount:function(b){var a=0,c;for(c in b)b.hasOwnProperty(c)&&a++;return a},printObject:function(b){var a="";$.each(b,function(b,d){a+=b+" , "+d+"\n"});return a},printProperties:function(b){var a="";$.each(b,function(b,
d){a+=b+"\n"});return a},scrollToTop:function(){window.scrollTo(0,0)},printKeys:function(b){var a="";$.each(b,function(b,d){0<a.length&&(a+=",");a+=b});return a},setVisibility:function(b,a){a?$(b).show():$(b).hide()}};console.log("Module ready: util.js");return d}();console.log("running module: view.js");
var view=function(){var d={updateStatusBar:function(){if(meta64.currentNodeData){var b="";meta64.editModeOption===meta64.MODE_ADVANCED&&(b+="count: "+meta64.currentNodeData.children.length);meta64.editMode&&(b+=" Selections: "+util.getPropertyCount(meta64.selectedNodes));var a=0<b.length;util.setVisibility("#mainNodeStatusBar",a);a&&util.getRequiredElement("#mainNodeStatusBar").html(b)}},refreshTreeResponse:function(b,a){render.renderPageFromData(b);a&&a.targetId&&a.renderParentIfLeaf&&b.displayedParent?
meta64.highlightRowById(a.targetId,!0):d.scrollToSelectedNode();meta64.refreshAllGuiEnablement()},refreshTree:function(b,a){b||(b=meta64.currentNodeId);util.json("renderNode",{nodeId:b,renderParentIfLeaf:a?!0:!1},d.refreshTreeResponse,{targetId:b,renderParentIfLeaf:a})},scrollToSelectedNode:function(){setTimeout(function(){var b=nav.getSelectedDomElement();if(b){var a=meta64.getHighlightedNode(),b=0==meta64.getOrdinalOfNode(a)?0:$("#"+b.id).offset().top-$("#mainPageHeader").height();$("html, body").animate({scrollTop:b})}},
1E3)},initEditPathDisplayById:function(b){var a=edit.editNode;b=$(b);edit.editingUnsavedNode?b.hide():(b.html("Path: "+render.formatPath(a.path)),b.show())}};console.log("Module ready: view.js");return d}();
